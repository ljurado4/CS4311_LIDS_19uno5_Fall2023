Common backend code shared by CLI and GUI
Delete this later